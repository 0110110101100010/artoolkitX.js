<html>
<body>
          <script type='text/javascript'>
      window.artoolkitX_wasm_url = '../SDK/lib/artoolkitx.wasm';
          </script>

          <script type="module" src="../SDK/lib/artoolkitX.api.js"></script>
<video id="v" src="Data/output_4.mp4" width="320" height="240" loop="" controls="" autoplay></video>
          <script type="module">
          import ARController from '../SDK/lib/artoolkitX.api.js';

let ar1, interval;

const cameraParam = './Data/camera_para.dat';

const config = {
    cameraParam: cameraParam,
    width: 640,
    height: 480
};

var trackable = {
    trackableType: "single_barcode",
    barcodeId: 1
}

 window.addEventListener('artoolkitX-loaded', () => {

//ARController.getUserMediaARController(config).then( arController => {
var arController = new ARController(v, cameraParam);

    arController.addEventListener('getMarker', (trackableInfo) => {
        console.log("TrackableID: " + trackableInfo.data.trackableId);
        console.log(trackableInfo.data.transformation);
    });
    var video = document.getElementById('v');
    try {
        //arController.setLogLevel(1);
        arController.start().then( () => {
            console.log("start done");
            var trackableId = arController.addTrackable(trackable);
            interval = setInterval(function() {
                arController.process(video);
            }, 13);
            ar1 = arController;
        });
        arController.debugSetup();
    }
    catch (e) {
        console.log(e);
    }
//} );
 });

window.closeVideo = function() {
    if(ar1) {
        ar1.dispose();
        clearInterval(interval);
    }
    else {
        console.error("Trying to close before opened");
    }
}


</script>

<button onclick="window.closeVideo()">Close Video</button>
</body>
</html>
